<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Mapa Interativo do Paraná</title>

<!-- Bibliotecas amCharts -->
<script src="https://cdn.amcharts.com/lib/5/index.js"></script>
<script src="https://cdn.amcharts.com/lib/5/map.js"></script>
<script src="https://cdn.amcharts.com/lib/5/geodata/brazilLow.js"></script>
<script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>

<style>
  html, body {
    width: 100%;
    height: 100%;
    margin: 0;
    background: #f0f8f5;
    font-family: Arial, sans-serif;
  }

  #mapa-parana {
    width: 100%;
    height: 100vh;
  }

  .am5-tooltip {
    font-size: 13px;
  }
</style>
</head>

<body>
<div id="mapa-parana"></div>

<script>
am5.ready(function() {

  // Inicializa o mapa
  var root = am5.Root.new("mapa-parana");
  root.setThemes([am5themes_Animated.new(root)]);

  var chart = root.container.children.push(am5map.MapChart.new(root, {
    projection: am5map.geoMercator(),
    panX: "translateX",
    panY: "translateY",
    wheelY: "zoom"
  }));

  // Carrega GeoJSON com os municípios do Paraná (IBGE)
  var geoUrl = "https://raw.githubusercontent.com/tbrugz/geodata-br/master/geojson/geojs-41-mun.json";

  fetch(geoUrl)
    .then(response => response.json())
    .then(data => {

      var polygonSeries = chart.series.push(am5map.MapPolygonSeries.new(root, {
        geoJSON: data
      }));

      polygonSeries.mapPolygons.template.setAll({
        tooltipText: "{name}",
        interactive: true,
        fill: am5.color(0xa5d6a7),
        stroke: am5.color(0x33691e),
        strokeWidth: 0.2
      });

      polygonSeries.mapPolygons.template.states.create("hover", {
        fill: am5.color(0x43a047)
      });

      // Evento de clique em cada município
      polygonSeries.mapPolygons.template.events.on("click", function(ev) {
        const nomeCidade = ev.target.dataItem.dataContext.name;

        // Envia o nome da cidade para o Odoo (pai do iframe)
        window.parent.postMessage({ city: nomeCidade }, "*");

        // Opcional: para debug
        console.log("Cidade enviada:", nomeCidade);
      });

    })
    .catch(err => console.error("Erro ao carregar mapa:", err));

  chart.appear(1000, 100);
});
</script>

</body>
</html>

