<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Mapa Interativo do Paraná — Regiões Coloridas</title>

<script src="https://cdn.amcharts.com/lib/5/index.js"></script>
<script src="https://cdn.amcharts.com/lib/5/map.js"></script>
<script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>

<style>
  html,body{width:100%;height:100%;margin:0;background:#f0f8f5;font-family:'Poppins',Arial,sans-serif}
  #mapa-parana{width:100%;height:100vh}
  .am5-tooltip{font-size:14px;font-weight:600}
</style>
</head>

<body>
<div id="mapa-parana"></div>

<script>
am5.ready(async function() {
  const root = am5.Root.new("mapa-parana");
  root.setThemes([am5themes_Animated.new(root)]);

  const chart = root.container.children.push(am5map.MapChart.new(root,{
    projection: am5map.geoMercator(),
    panX:"translateX",panY:"translateY",wheelY:"zoom"
  }));

  const coresPorRegiao={
    "Noroeste Paranaense":"#FFD54F",
    "Norte Central Paranaense":"#4CAF50",
    "Norte Pioneiro Paranaense":"#81C784",
    "Centro Ocidental Paranaense":"#FBC02D",
    "Centro Oriental Paranaense":"#388E3C",
    "Oeste Paranaense":"#2196F3",
    "Sudoeste Paranaense":"#1976D2",
    "Centro-Sul Paranaense":"#8E24AA",
    "Sudeste Paranaense":"#5E35B1",
    "Metropolitana de Curitiba":"#E53935"
  };

  // API IBGE - lista todos os 399 municípios do PR
  const municipiosResp = await fetch("https://servicodados.ibge.gov.br/api/v1/localidades/estados/41/municipios");
  const municipios = await municipiosResp.json();

  // JSON externo com a região de cada município
  const regioesResp = await fetch("https://raw.githubusercontent.com/gustavosampaio-dev/dados-parana/main/regioes-pr.json");
  const regioesMunicipios = await regioesResp.json();

  const geoUrl="https://raw.githubusercontent.com/tbrugz/geodata-br/master/geojson/geojs-41-mun.json";
  const geoData=await fetch(geoUrl).then(r=>r.json());

  const polygonSeries=chart.series.push(am5map.MapPolygonSeries.new(root,{geoJSON:geoData}));
  polygonSeries.mapPolygons.template.setAll({
    tooltipText:"{name}",interactive:true,
    stroke:am5.color(0xffffff),strokeWidth:0.25,cursorOverStyle:"pointer"
  });

  polygonSeries.events.on("datavalidated",function(){
    polygonSeries.mapPolygons.each(function(polygon){
      const nomeCidade=polygon.dataItem.dataContext.name;
      const regiao=regioesMunicipios[nomeCidade];
      const cor=regiao && coresPorRegiao[regiao]?coresPorRegiao[regiao]:"#C8E6C9";
      polygon.set("fill",am5.color(cor));
    });
  });

  polygonSeries.mapPolygons.template.states.create("hover",{
    fill:am5.color(0x43a047),scale:1.05,shadowColor:am5.color(0x000000),shadowBlur:6
  });

  polygonSeries.mapPolygons.template.events.on("click",function(ev){
    const nomeCidade=ev.target.dataItem.dataContext.name;
    window.parent.postMessage({city:nomeCidade},"*");
    console.log("Cidade enviada:",nomeCidade);
  });

  chart.appear(1000,100);
});
</script>
</body>
</html>
